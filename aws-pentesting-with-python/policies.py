#!/usr/bin/env python3

# get acoount authorization detailsusing boto3 and aws-shell (aws-cli)

import boto3
import json
import sys
import os
import pprint
from color import color
# declare env var for aws-shell

AWS_ACCESS_KEY_ID = os.environ["AWS_ACCESS_KEY_ID"]
AWS_SECRET_ACCESS_KEY = os.environ["AWS_SECRET_ACCESS_KEY"]

client = boto3.client('iam')

response = client.list_policies(
    Scope='All'
)

paginator = client.get_paginator("list_policies")

# for page in paginator.paginate():
#     for policy in page['Policies']:
#         print(f'  - {policy["PolicyName"]}')


IAM_RESOURCE = boto3.resource('iam')

policies = IAM_RESOURCE.policies.filter(
    Scope='AWS',
    PolicyUsageFilter='PermissionsPolicy',
    PathPrefix='/service-role/'
)

print('Search results:')

for policy in policies:
    print(f'  - {policy.policy_name}')
