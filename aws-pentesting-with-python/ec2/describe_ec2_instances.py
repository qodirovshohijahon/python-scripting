import boto3
import json
import os
from json_datetime_serializer import json_datetime_serializer
import logging
from moto import mock_ec2


logger = logging.getLogger()
logging.basicConfig(level=logging.INFO,
                    format='%(asctime)s: %(levelname)s: %(message)s')


# Describing the instanc 

# @mock_ec2
def describe_instances(instance_id):
    client = boto3.client('ec2')
    response = client.describe_instances(
        InstanceIds=[
            instance_id,
        ]
    )
    return response['Reservations'][0]['Instances'][0]['BlockDeviceMappings'][0]['Ebs']['VolumeId']
# ['Reservations'][0]['Instances'][0]['State']['Name']

if __name__ == '__main__':
    logger.info('EC2 Stopping function......!')
    instance_id = input('Enter an instance id: ')   
    ec2 = describe_instances(instance_id)
    logger.info('Stopping ec2 instance...')
    logger.info(
        f'Returning EC2 instance image id: {json.dumps(ec2, indent=4, default=json_datetime_serializer)}'
    )
    logger.info('Done!')
    
        