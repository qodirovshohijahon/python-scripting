from http import client
import boto3
import json
import logging
import os
import botocore
import time
from json_datetime_serializer import json_datetime_serializer

logger = logging.getLogger()
logging.basicConfig(level=logging.INFO,
                    format='%(asctime)s: %(levelname)s: %(message)s')

def describe_volume(instance_id):
    client = boto3.client('ec2')
    volume_id = client.describe_instances(
        InstanceIds=[
            instance_id,
        ]
    )
    response = client.describe_volumes(
        VolumeIds=[
            volume_id['Reservations'][0]['Instances'][0]['BlockDeviceMappings'][0]['Ebs']['VolumeId']
        ]
    )
    return response['Volumes'][0]


logger.info('Describe volume function......!')
instance_id = 'i-0db03d4defe2f29c3'
# input('Enter an instance id: ')   
ec2_volume = describe_volume(instance_id)
logger.info('Getting info ...')
logger.info(
    f'Volume details: {json.dumps(ec2_volume, indent=4, default=json_datetime_serializer)}'
)
logger.info('Done!')
