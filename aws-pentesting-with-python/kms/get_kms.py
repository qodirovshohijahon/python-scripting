#!/usr/bin/env python3

# get acoount authorization detailsusing boto3 and aws-shell (aws-cli)

import boto3
import json
import sys
import os
import pprint
import boto3

# declare env var for aws-shell

session = boto3.Session(profile_name='k8s-user')
client = boto3.client('kms',
                      aws_access_key_id=' ', 
                      aws_secret_access_key='  ', 
                      region_name='eu-central-1')

# response = client.list_keys()
# print(response)

def getAllKMS():
    """Retrieve an existing KMS CMK based on its description"""

    # Retrieve a list of existing CMKs
    # If more than 100 keys exist, retrieve and process them in batches
    kms_client = boto3.client('kms',
                      aws_access_key_id=' ', 
                      aws_secret_access_key='  ', 
                      region_name='eu-central-1')
    response = kms_client.list_keys()

    # for cmk in response["Keys"]:
    #     key_info = kms_client.describe_key(KeyId=cmk["KeyArn"])
    #     # if key_info["KeyMetadata"]["Description"] == description:
    #     #     return cmk["KeyId"], cmk["KeyArn"]
    #     return key_info["KeyMetadata"]["KeyId"], key_info["KeyMetadata"]["Arn"]
    # # No matching CMK found
    return response


# print(getAllKMS())

def getSingleKMS():
    """Retrieve an existing KMS CMK based on its description"""

    kms_client = boto3.client('kms',
                      aws_access_key_id=' ', 
                      aws_secret_access_key='  ', 
                      region_name='eu-central-1')
    response = kms_client.describe_key(KeyId='arn:aws:kms:eu-central-1:632660066814:key/d8fc206b-a404-4e4f-946c-798949194401')

    # for cmk in response["KeyMetadata"]:
    #     key_info = kms_client.describe_key(KeyId=cmk["KeyArn"])
    #     # if key_info["KeyMetadata"]["Description"] == description:
    #     #     return cmk["KeyId"], cmk["KeyArn"]
    #     return key_info["KeyMetadata"]["KeyId"], key_info["KeyMetadata"]["Arn"]
    return response['KeyMetadata']['Arn']
# ['KeyMetadata']['KeyId'], response['KeyMetadata']['Arn']

print(getSingleKMS())    