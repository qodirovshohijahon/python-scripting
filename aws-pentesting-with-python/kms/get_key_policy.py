from email.policy import Policy
from http import client
import json
import logging
from datetime import date, datetime

import boto3
from botocore.exceptions import ClientError
from correct.json_datetime_serializer import json_datetime_serializer

# logger config
logger = logging.getLogger()
logging.basicConfig(level=logging.INFO,
                    format='%(asctime)s: %(levelname)s: %(message)s')

def get_key_policy(keyId, policyName):
    """
    Provides detailed information about a KMS key.
    """
    try:
        client = boto3.client('kms')
        response = client.get_key_policy(
            KeyId=keyId,
            PolicyName=policyName
        )
        # describe_key(KeyId=keyId, GrantTokens=[])
    except ClientError:
        logger.exception('Could not describe a KMS key.')
        raise
    else:
        return response['Policy']


if __name__ == '__main__':
    # Constants
    KEY_ID = '4bd80467-916b-4a8d-b20b-157253518086'
    logger.info('Getting information about KMS key...')
    kms = get_key_policy(KEY_ID, 'default')
    logger.info(
        f'Key Details: {json.dumps(kms, indent=4, default=json_datetime_serializer)}'
    )