import json
import logging
from datetime import date, datetime

import boto3
from botocore.exceptions import ClientError

AWS_REGION = 'eu-central-1'

# logger config
logger = logging.getLogger()
logging.basicConfig(level=logging.INFO,
                    format='%(asctime)s: %(levelname)s: %(message)s')

kms_client = boto3.client("kms", region_name=AWS_REGION)


def json_datetime_serializer(obj):
    """
    Helper method to serialize datetime fields
    """
    if isinstance(obj, (datetime, date)):
        return obj.isoformat()
    raise TypeError("Type %s not serializable" % type(obj))


def get_key_policy(keyId, policyName):
    """
    Provides detailed information about a KMS key.
    """
    try:
        response = kms_client.describe_key(KeyId=alias)

    except ClientError:
        logger.exception('Could not describe a KMS key.')
        raise
    else:
        return response


if __name__ == '__main__':
    # Constants
    KEY_ID = 'd8fc206b-a404-4e4f-946c-798949194401'
    logger.info('Getting information about KMS key...')
    kms = describe_kms_key('alias/k8s-kms-key')
    logger.info(
        f'Key Details: {json.dumps(kms, indent=4, default=json_datetime_serializer)}'
    )