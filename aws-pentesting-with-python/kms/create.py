import json
import logging
from datetime import date, datetime
import boto3
from correct.kms_client import kmsClient
from correct.json_datetime_serializer import json_datetime_serializer
from botocore.exceptions import ClientError
import os

# configure logging

logger = logging.getLogger()
logging.basicConfig(level=logging.INFO,
                    format='%(asctime)s: %(levelname)s: %(message)s')


# Constants


def create(kmsName):
    KEY_USAGE = 'ENCRYPT_DECRYPT'
    KEY_SPEC = 'RSA_2048'
    ORIGIN = 'AWS_KMS'
    MULTI_REGION = True
    kmsClient = boto3.client(
        "kms",
        aws_access_key_id="AKIA4RWJ4D2DDZTARPWA",
        # os.environ["AWS_ACCESS_KEY_ID"],
        aws_secret_access_key="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",
        # os.environ["AWS_SECRET_ACCESS_KEY"],
        region_name="us-west-1",
        # os.environ["AWS_REGION"],
    )
    response = kmsClient.create_key(
        KeyUsage=KEY_USAGE,
        KeySpec=KEY_SPEC,
        # MultiRegion=MULTI_REGION,
        Description=f"{kmsName}--created for testing purpose--",
    )
    return response, response["KeyMetadata"]["KeyId"]
    
    
    
if __name__ == '__main__':
    logger.info('KMS Creating function......!')
    KMS_NAME=input('Enter a name for your KMS key: ')   
    kmc_create = create(KMS_NAME)
    kms=kmc_create[1]
    logger.info('Creating a symetric CMK...')
    logger.info(
        f'Symetric CMK is created with details: {json.dumps(kms, indent=4, default=json_datetime_serializer)}'
    )
    logger.info('Done!')
    
        