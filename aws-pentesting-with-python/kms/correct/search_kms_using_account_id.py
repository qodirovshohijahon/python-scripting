import boto3
import logging
from datetime import date, datetime
from botocore.exceptions import ClientError
import json
from json_datetime_serializer import json_datetime_serializer
from kms_client import kmsClient


def search_kms_using_account_id(account_id):
    client = kmsClient()
    response = client.list_keys()
    kms_keys = response["Keys"]
    kms_keys_matching_account_id = []
    for kms_key in kms_keys:
        if kms_key["KeyArn"].split(":")[4] == account_id:
            kms_keys_matching_account_id.append(kms_key)
    return kms_keys_matching_account_id


logger = logging.getLogger()
logging.basicConfig(
    level=logging.INFO, format="%(asctime)s: %(levelname)s: %(message)s"
)

if __name__ == "__main__":

    # calling function and setting the account_id
    kms = search_kms_using_account_id("862638055046")

    logger.info("Getting information about KMS key...")
    logger.info(
        f"Key Details: {json.dumps(kms, indent=4, default=json_datetime_serializer)}"
    )
    logger.info("Done!")

# print(search_kms_using_account_id('862638055046'))
