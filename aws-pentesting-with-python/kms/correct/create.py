import json
import logging
from datetime import date, datetime
import boto3
from kms_client import kmsClient
from json_datetime_serializer import json_datetime_serializer
from botocore.exceptions import ClientError
import os

# configure logging

logger = logging.getLogger()


# Constants


def create(kmsName):
    KEY_USAGE = 'ENCRYPT_DECRYPT'
    KEY_SPEC = 'RSA_2048'
    ORIGIN = 'AWS_KMS'
    MULTI_REGION = True
    kmsClient = boto3.client(
        "kms",
        aws_access_key_id=os.environ["AWS_ACCESS_KEY_ID"],
        aws_secret_access_key=os.environ["AWS_SECRET_ACCESS_KEY"],
        region_name=os.environ["AWS_REGION"],
    )
    response = kmsClient.create_key(
        KeyUsage=KEY_USAGE,
        KeySpec=KEY_SPEC,
        Origin=ORIGIN,
        MultiRegion=MULTI_REGION,
        Description=f"{kmsName}-{Origin}-{MultiRegion}-{KeyUsage}-{MultiRegion}",
    )
    return response
    
    
    
if __name__ == '__main__':
    logger.info('KMS Creating function......!')
    KMS_NAME=input('Enter a name for your KMS key: ')   
    kmc_create = create(KMS_NAME)
    logger.info('Creating a symetric CMK...')
    logger.info(
        f'Symetric CMK is created with details: {json.dumps(kmc_create, indent=4, default=json_datetime_serializer)}'
    )
    logger.info('Done!')
    
        